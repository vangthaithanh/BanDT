@using WebDienThoai.Models
<!DOCTYPE html>
<html>
<head>
    @Styles.Render("~/Content/css")
    @Scripts.Render("~/bundles/modernizr")
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <link rel="stylesheet" href="~/Content/ThongTin.css">
    <link rel="stylesheet" href="~/Content/Card.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="~/Content/trangchu.js"></script>
    <style>
        body {
            margin-top: 0 !important;
            padding-top: 0 !important;
        }

        .breadcrumb-bar {
            padding: 8px 24px;
            background: #f5f5f5;
            font-size: 14px;
            font-weight: bold;
        }

            .breadcrumb-bar a {
                color: #007bff;
                text-decoration: none;
                color: black
            }

        body {
            margin: 0;
            padding: 0;
        }

        .sticky-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: #eae2d7;
        }

        .container.body-content {
            margin-top: 40px; /* chỉnh số này tới khi vừa ý */
        }
    </style>
</head>
<div class="modal fade" id="loginRequiredModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 rounded-4">

            <div class="modal-header border-0 pb-0 d-flex justify-content-center position-relative">

                <h5 class="modal-title fw-bold text-center" style="color:#aa1945;">HMember</h5>

                <button type="button" class="btn-close position-absolute top-0 end-0 mt-3 me-3" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center pt-2 pb-4">
                <img src="~/Anh/logo/headerlogo.png" alt="logo" style="max-height:100px;" class="mb-3" />
                <p class="mb-4">Vui lòng đăng nhập hoặc đăng kí tài khoản để mua hàng nhanh chóng hơn.</p>

                <div class="d-flex justify-content-center gap-3">
                    <a class="custom-btn btn fw-bold text-uppercase"
                       href="@Url.Action("Login","Account")">Đăng nhập</a>

                    <a class="custom-btn btn fw-bold text-uppercase"
                       href="@Url.Action("Register","Account")">Đăng kí</a>
                </div>
            </div>
        </div>
    </div>
</div>
<body>
    <div class="sticky-header">
        <div>
            @Html.Partial("_Header")
        </div>
        <div class="header-spacer"></div>

        <div class="breadcrumb-bar">
            @{
                // Prefer rendering a view-defined section first to satisfy Razor verification.
                var bcList = ViewBag.BreadcrumbList as IEnumerable<WebDienThoai.Models.BreadcrumbItem>;
                var bc = (ViewBag.Breadcrumb ?? "").ToString();
                var parts = new System.Collections.Generic.List<string>();
                if (!string.IsNullOrWhiteSpace(bc))
                {
                    var raw = bc.Split('/');
                    foreach (var p in raw)
                    {
                        if (!string.IsNullOrWhiteSpace(p))
                        {
                            parts.Add(p.Trim());
                        }
                    }
                }
            }

            @* 1) Nếu view định nghĩa section Breadcrumb thì render nó (bắt buộc) *@
            @if (IsSectionDefined("Breadcrumb"))
            {
                @RenderSection("Breadcrumb", required: false)
            }
            @* 2) Nếu controller set BreadcrumbList thì hiển thị list (ưu tiên nếu view không có section) *@
            else if (bcList != null)
            {
                var first = true;
                foreach (var item in bcList)
                {
                    if (!first)
                    {
                        <text> / </text>
                    }
                    first = false;

                    if (item != null && item.IsLink)
                    {
                        <a href="@Url.Action(item.Action, item.Controller, item.RouteValues)">@item.Text</a>
                    }
                    else
                    {
                        @Html.Raw(item?.Text)
                    }
                }
            }
            @* 3) Fallback: cũ dùng ViewBag.Breadcrumb string *@
            else if (parts.Count > 0)
            {
                for (int i = 0; i < parts.Count; i++)
                {
                    var part = parts[i];
                    if (i == 0 && string.Equals(part, "Trang chủ", System.StringComparison.OrdinalIgnoreCase))
                    {
                        <a href='@Url.Action("Index", "Home")'>@part</a>
                    }
                    else
                    {
                        @Html.Raw(part)
                    }

                    if (i < parts.Count - 1)
                    {
                        <text> / </text>
                    }
                }
            }
        </div>
    </div>
    <div class="container body-content main-content">
        @RenderBody()
        <hr />
    </div>
    <div>
        @Html.Partial("_Footer")
    </div>
    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/bootstrap")
    <script>
    window.__isLoggedIn = @((Session["UserName"] != null).ToString().ToLower());

    function showLoginModal() {
        const el = document.getElementById('loginRequiredModal');
        if (!el) return;
        bootstrap.Modal.getOrCreateInstance(el).show();
    }

    // Chặn các form post tới MuaNgay/ThanhToan khi chưa đăng nhập
    document.addEventListener('submit', function (ev) {
        if (window.__isLoggedIn) return;

        const form = ev.target;
        if (!(form instanceof HTMLFormElement)) return;

        const action = (form.getAttribute('action') || '').toLowerCase();

        if (action.includes('/giohang/muangay') || action.includes('/giohang/thanhtoan')) {
            ev.preventDefault();
            showLoginModal();
        }
    }, true);
    </script>

    @RenderSection("scripts", required: false)
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
    <script>
        const carousel = document.querySelector('#productCarousel');
        const captions = document.querySelectorAll('.caption-item');

        carousel.addEventListener('slide.bs.carousel', function (e) {
            captions.forEach(c => c.classList.remove('active'));
            captions[e.to].classList.add('active');
        });
    </script>

</body>
</html>